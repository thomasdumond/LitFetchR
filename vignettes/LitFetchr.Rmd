---
title: "LitFetchR (Tutorial)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{LitFetchr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Before continuing to the general package tutorial, make sure to have received your Scopus and Web of Science API keys. If not, the package will only access PubMed. If you don't know how to get API keys, have a look at the article [Get API keys](https://thomasdumond.github.io/LitFetchR/articles/Get_API_keys.html).

## Setup
We strongly recommend to create a new R directory for each individual review project. To do so in RStudio:

* Go to `File`>`New Projectâ€¦`>`New Directory`>`New Project`

* Choose a name for your directory (*e.g. review_fish_vibrio*), then `Browse...` to choose where to save the directory.

    *We suggest to save the directory on you computer (e.g. `C:/users/...`) instead of clouds (e.g. OneDrive, Box, etc.), as restriction access from institution might block R.*

* Click `Create Project`

From your new directory, install `LitFetchR` from GitHub: 
```{r, eval = FALSE}
#This step can be skipped if `LitFetchR` is already installed

#Install using devtools package
install.packages("devtools")
devtools::install_github("thomasdumond/LitFetchR")

#or

#Install using remotes package
install.packages("remotes")
remotes::install_github("thomasdumond/LitFetchR")
```
Then load the package:
```{r, eval = FALSE}
#Load LitFetchR
library(LitFetchR)
```

## Save API keys
Save your API keys in your personal R environment:
```{r, eval = FALSE}
#This step can be skipped if your API keys have already been saved. Repeat this step if your API keys changed.

#Load LitFetchR
library(LitFetchR)

#Save API keys in your R environment
save_api_keys(WOS_API_KEY = "your-wos-api-key", SCP_API_KEY = "your-scp-api-key")

#Example of what you should see:
#> save_api_keys(WOS_API_KEY = "abcd01234", SCP_API_KEY = "efgh5678")
#Saved key(s) WOS_API_KEY, SCP_API_KEY to -path-to-your-renvironment/.Renviron.
#Restart R for the new environment variable(s) to be available.
```
This will allow `LitFetchR` to locally access your personal API keys while keeping them confidential if you need to share your code with collaborators.

As mentionned by R, it is important to restart your session before continuing:

`Session`>`Restart R`

Then load LitFetchR again using `library(LitFetchR)`

*If you don't have API keys for Scopus and Web of Science, see [Get API keys](https://thomasdumond.github.io/LitFetchR/articles/Get_API_keys.html).*

## Save the review search string(s)
The interactive `create_save_search()` function will guide you through its workflow. Here is an example of what you should see:

```{r, eval=FALSE}
#Load LitFetchR
library(LitFetchR)

#The following function can help to create your search string(s)
#It has to be used to save your search string(s)
create_save_search()

# Example of what you should see building the search: fish AND "vibrio harveyi" AND diagnostic
#
# > create_save_search()
# History had been created.
# Enter your search string (or 'summary' or 'exit'): fish
# [1] "fish"
# [1] "Web of Science: 1793296 results"
# [1] "Scopus: 718644 results"
# [1] "PubMed: 384742 results"
# Enter your search string (or 'summary' or 'exit'): fish AND "vibrio harveyi"
# [1] "fish AND \"vibrio harveyi\""
# [1] "Web of Science: 2084 results"
# [1] "Scopus: 1080 results"
# [1] "PubMed: 727 results"
# Enter your search string (or 'summary' or 'exit'): fish AND "vibrio harveyi" AND diagnostic
# [1] "fish AND \"vibrio harveyi\" AND diagnostic"
# [1] "Web of Science: 126 results"
# [1] "Scopus: 22 results"
# [1] "PubMed: 106 results"
# Enter your search string (or 'summary' or 'exit'): summary
#                                Search_Term Results_WOS Results_SCP Results_PMD
# 1                                     fish     1793296      718644      384742
# 2                fish AND "vibrio harveyi"        2084        1080         727
# 3 fish AND "vibrio harveyi" AND diagnostic         126          22         106
# Select the index number for the search string to use in automated retrieval: 3
# 
# Selected search string: fish AND "vibrio harveyi" AND diagnostic 
# Do you want to save the search string for future use? (yes/no): yes
# Enter a name for the search identification: fish_vibrio
# Search string saved successfully.
# Enter your search string (or 'summary' or 'exit'): exit
# Exiting search tool.
```

After using `create_save_search()`, two new files will appear in your directory:

* search_list.txt

    *This file contains the name and search string that you saved using `create_save_search()`. It is an essential file to retrieve the reference later. If you modify the search string in this file, the modified search string will be used for future reference retrieval.*
  
* history_search.xlsx

    *This file contains all the search that you run when using the function `create_save_search()`. Each time you run the function, it creates a new sheet named with the current date and saves both the search string sent to the literature platforms, and the number of results that they returned.*

If you already validated your review search string, use `create_save_search()` to save the search string and setup the file required to continue toward the automation of reference retrieval.

## Setup the automatic reference retrieval

The automated reference retrieval uses either Windows Task Scheduler or Cron (Mac/Linux). You do not have to specify it, `LitFetchR` will detect the system and setup the task for you using the following:

```{r, eval=FALSE}
#Load LitFetchR
library(LitFetchR)

#We recommend using a single word for the *task_ID* or to use underscores "_" to separate words.
#The retrieval frequency is currently available "DAILY", "WEEKLY" or "MONTHLY".
#You need to use a 24H format for the time of reference retrieval.
#If you do not have an API key for WOS and/or SCP or want to exclude any database,
#change "TRUE" to "FALSE" in front of the corresponding database (e.g.`WOS = FALSE`).

auto_LitFetchR_setup(task_ID = "name_of_your_task",
                     when = "DAILY",
                     time = "09:00",
                     WOS = TRUE,
                     SCP = TRUE,
                     PMD = TRUE)

#Example fo what you should see
#> auto_LitFetchR_setup(task_ID = "fish_vibrio",
                     # when = "WEEKLY",
                     # time = "14:00",
                     # WOS = TRUE,
                     # SCP = TRUE,
                     # PMD = TRUE)
#Task scheduled!
```

After running `auto_LitFetchR_setup()` for the first time, four new files will be created:

* history_id.xlsx

    *This file contains all the databases unique identifiers (e.g. PMID or  SCOPUS_ID). These are saved and used at each reference retrieval to only extract the references that were not retrieved before.*

* history_dedup_YYYY_MM_HHMMSS.xlsx

    *This file contains the history of each steps of the deduplication, using the package ASySD.*

* citationsCSV_YYYY_MM_HHMMSS.CSV

    *This file contains the unique list of references retrieved from the search conducted at the date referenced in the name of the file. It is a CSV file, ready to be imported in the screening tool of your choice or in your reference manager.*

* auto_LitFetchR_code(READ_ONLY).R

    *This file contains the code that is automatically run by the scheduled task. It is set as "READ ONLY" to avoid accidental modification that would impair the scheduled task action. If you deleted this file by accident, use the `auto_LitFetchR_setup()` to create a new task and a new code file.*

Each time *auto_LitFetchR_code(READ_ONLY).R* runs, new unique *history_dedup_* and *citationCSV_* files are created and *history_id* is updated.

**Congratulations ! Your automated reference retrieval is ready to work !**

## See also

* [Remove or change a scheduled task](https://thomasdumond.github.io/LitFetchR/articles/remove_task.html)

* [Manual reference retrieval](https://thomasdumond.github.io/LitFetchR/articles/manual_fetch.html)
